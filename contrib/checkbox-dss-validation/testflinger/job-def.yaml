job_queue: REPLACE_QUEUE
output_timeout: 1800
provision_data:
  REPLACE_PROVISION_DATA
test_data:
  attachments:
    - local: checkbox-dss.snap
  test_cmds: |

    # Exit immediately if a test fails
    set -e

    # Copy the checkbox-dss.snap to the device
    scp attachments/test/checkbox-dss.snap ubuntu@$DEVICE_IP:~ubuntu/checkbox-dss.snap

    # Install dependencies
    ssh -t ubuntu@$DEVICE_IP '
      sudo snap install checkbox22
      sudo snap install --dangerous --classic ./checkbox-dss.snap
    '

    # Install test dependencies
    ssh -t ubuntu@$DEVICE_IP '
      checkbox-dss.install-deps --dss-snap-channel REPLACE_DSS_CHANNEL --REPLACE_K8S_TYPE-snap-channel REPLACE_K8S_CHANNEL
    '

    # Run tests
    ssh -t ubuntu@$DEVICE_IP '
      checkbox-dss.validate-with-gpu
    '
