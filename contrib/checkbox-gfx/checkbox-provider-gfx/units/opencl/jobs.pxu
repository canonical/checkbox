plugin: resource
id: gfx_cl_gpu_avail
category_id: opencl
user: root
requires:
  package.name == 'clinfo'
_summary: Checks for GPU for OpenCL
environ:
  # necessary for local mode
  XDG_SESSION_TYPE
  XDG_RUNTIME_DIR
estimated_duration: 1
command:
  GPU_STR=$(clinfo | grep -oE "Device Type.*GPU")
  if [ -z "$GPU_STR" ]; then
    echo "FAIL: No GPU available in clinfo"
    exit 1
  fi
  echo "PASS: Found a GPU for OpenCL"
  exit 0

id: gfx_cl_basic
depends: gfx_cl_gpu_avail
category_id: opencl
flags: simple
user: root
_summary: Run the basic tests from OpenCL-CTS
environ:
  # necessary for local mode
  XDG_SESSION_TYPE
  XDG_RUNTIME_DIR
estimated_duration: 5m
command: /usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/basic/test_basic
_siblings: [
  { "id": "gfx_cl_geometrics",
    "_summary": "Run the geometrics tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/geometrics/test_geometrics" },
  { "id": "gfx_cl_api",
    "_summary": "Run the api tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/api/test_api" },
  { "id": "gfx_cl_compiler",
    "_summary": "Run the compiler tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/compiler/test_compiler" },
  { "id": "gfx_cl_commonfns",
    "_summary": "Run the commonfns tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/commonfns/test_commonfns" },
  { "id": "gfx_cl_relationals",
    "_summary": "Run the relationals tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/relationals/test_relationals" },
  { "id": "gfx_cl_thread_dimensions",
    "_summary": "Run the thread_dimensions tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/thread_dimensions/test_thread_dimensions full*" },
  { "id": "gfx_cl_mult_device_contexts",
    "_summary": "Run the mult_device_contexts tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/multiple_device_context/test_multiples" },
  { "id": "gfx_cl_atomics",
    "_summary": "Run the atomics tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/atomics/test_atomics" },
  { "id": "gfx_cl_profiling",
    "_summary": "Run the profiling tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/profiling/test_profiling" },
  { "id": "gfx_cl_events",
    "_summary": "Run the events tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/events/test_events" },
  { "id": "gfx_cl_allocations_single",
    "_summary": "Run the allocations_single tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/allocations/test_allocations single 5 all" },
  { "id": "gfx_cl_allocations_multiple",
    "_summary": "Run the allocations_multiple tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/allocations/test_allocations multiple 5 all" },
  { "id": "gfx_cl_vectors",
    "_summary": "Run the vectors tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/vectors/test_vectors" },
  { "id": "gfx_cl_printf",
    "_summary": "Run the printf tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/printf/test_printf" },
  { "id": "gfx_cl_dev_partition",
    "_summary": "Run the dev_partition tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/device_partition/test_device_partition" },
  { "id": "gfx_cl_buffers",
    "_summary": "Run the buffers tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/buffers/test_buffers" },
  { "id": "gfx_cl_cl_get_info",
    "_summary": "Run the cl_get_info tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/clGetInfo/test_cl_get_info" },
  { "id": "gfx_cl_kernel_image_methods",
    "_summary": "Run the kernel_image_methods tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/kernel_image_methods/test_kernel_image_methods" },
  { "id": "gfx_cl_image_streams_nearest",
    "_summary": "Run the image_streams_nearest tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/kernel_read_write/test_image_streams CL_FILTER_NEAREST" },
  { "id": "gfx_cl_image_streams_pitches_nearest",
    "_summary": "Run the image_streams_pitches_nearest tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/kernel_read_write/test_image_streams use_pitches CL_FILTER_NEAREST" },
  { "id": "gfx_cl_image_streams_max_nearest",
    "_summary": "Run the image_streams_max_nearest tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/kernel_read_write/test_image_streams max_images CL_FILTER_NEAREST" },
  { "id": "gfx_cl_cl_copy_images",
    "_summary": "Run the cl_copy_images tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/clCopyImage/test_cl_copy_images" },
  { "id": "gfx_cl_cl_copy_small_images",
    "_summary": "Run the cl_copy_small_images tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/clCopyImage/test_cl_copy_images small_images" },
  { "id": "gfx_cl_cl_copy_max_images",
    "_summary": "Run the cl_copy_max_images tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/clCopyImage/test_cl_copy_images max_images" },
  { "id": "gfx_cl_read_write_images",
    "_summary": "Run the read_write_images tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/clReadWriteImage/test_cl_read_write_images" },
  { "id": "gfx_cl_read_write_images_pitches",
    "_summary": "Run the read_write_images_pitches tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/clReadWriteImage/test_cl_read_write_images use_pitches" },
  { "id": "gfx_cl_read_write_max_images",
    "_summary": "Run the read_write_max_images tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/clReadWriteImage/test_cl_read_write_images max_images" },
  { "id": "gfx_cl_cl_fill_images",
    "_summary": "Run the cl_fill_images tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/clFillImage/test_cl_fill_images" },
  { "id": "gfx_cl_cl_fill_images_pitches",
    "_summary": "Run the cl_fill_images_pitches tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/clFillImage/test_cl_fill_images use_pitches" },
  { "id": "gfx_cl_cl_fill_images_max",
    "_summary": "Run the cl_fill_images_max tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/clFillImage/test_cl_fill_images max_images" },
  { "id": "gfx_cl_samplerless_reads",
    "_summary": "Run the samplerless_reads tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/samplerlessReads/test_samplerless_reads" },
  { "id": "gfx_cl_samplerless_reads_pitches",
    "_summary": "Run the samplerless_reads_pitches tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/samplerlessReads/test_samplerless_reads use_pitches" },
  { "id": "gfx_cl_samplerless_reads_max",
    "_summary": "Run the samplerless_reads_max tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/samplerlessReads/test_samplerless_reads max_images" },
  { "id": "gfx_cl_mem_host_flags",
    "_summary": "Run the mem_host_flags tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/mem_host_flags/test_mem_host_flags" },
  { "id": "gfx_cl_image_streams_linear",
    "_summary": "Run the image_streams_linear tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/kernel_read_write/test_image_streams CL_FILTER_LINEAR" },
  { "id": "gfx_cl_image_streams_linear_pitches",
    "_summary": "Run the image_streams_linear_pitches tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/kernel_read_write/test_image_streams use_pitches CL_FILTER_LINEAR" },
  { "id": "gfx_cl_image_streams_linear_max",
    "_summary": "Run the image_streams_linear_max tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/kernel_read_write/test_image_streams max_images CL_FILTER_LINEAR" },
  { "id": "gfx_cl_gl",
    "_summary": "Run the gl tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/gl/test_gl" },
  { "id": "gfx_cl_select",
    "_summary": "Run the select tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/select/test_select" },
  { "id": "gfx_cl_conversions",
    "_summary": "Run the conversions tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/conversions/test_conversions" },
  { "id": "gfx_cl_contractions",
    "_summary": "Run the contractions tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/contractions/test_contractions" },
  { "id": "gfx_cl_bruteforce",
    "_summary": "Run the bruteforce tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/math_brute_force/test_bruteforce" },
  { "id": "gfx_cl_integer_ops",
    "_summary": "Run the integer_ops tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/integer_ops/test_integer_ops" },
  { "id": "gfx_cl_half",
    "_summary": "Run the half tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/half/test_half" },
  { "id": "gfx_cl_c11_atomics",
    "_summary": "Run the c11_atomics tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/c11_atomics/test_c11_atomics" },
  { "id": "gfx_cl_device_execution",
    "_summary": "Run the device_execution tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/device_execution/test_device_execution" },
  { "id": "gfx_cl_addr_space",
    "_summary": "Run the addr_space tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/generic_address_space/test_generic_address_space" },
  { "id": "gfx_cl_non_uniform_work_group",
    "_summary": "Run the non_uniform_work_group tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/non_uniform_work_group/test_non_uniform_work_group" },
  { "id": "gfx_cl_pipes",
    "_summary": "Run the pipes tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/pipes/test_pipes" },
  { "id": "gfx_cl_svm",
    "_summary": "Run the svm tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/SVM/test_svm" },
  { "id": "gfx_cl_workgroups",
    "_summary": "Run the workgroups tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/workgroups/test_workgroups" },
  { "id": "gfx_cl_device_timer",
    "_summary": "Run the device_timer tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/device_timer/test_device_timer" },
  { "id": "gfx_cl_spirv_new",
    "_summary": "Run the spirv_new tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/spirv_new/test_spirv_new --spirv-binaries-path spirv_bin" },
  { "id": "gfx_cl_spir",
    "_summary": "Run the spir tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/spir/test_spir" },
  { "id": "gfx_cl_image_streams_mipmaps",
    "_summary": "Run the image_streams_mipmaps tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/kernel_read_write/test_image_streams test_mipmaps CL_FILTER_NEAREST" },
  { "id": "gfx_cl_cl_copy_images_mipmaps",
    "_summary": "Run the cl_copy_images_mipmaps tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/clCopyImage/test_cl_copy_images test_mipmaps" },
  { "id": "gfx_cl_cl_read_write_images_mipmaps",
    "_summary": "Run the cl_read_write_images_mipmaps tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/images/clReadWriteImage/test_cl_read_write_images test_mipmaps" },
  { "id": "gfx_cl_subgroups",
    "_summary": "Run the subgroups tests from OpenCL-CTS",
    "command": "/usr/local/checkbox-gfx/OpenCL-CTS/build/test_conformance/subgroups/test_subgroups" }]
